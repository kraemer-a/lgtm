apiVersion: v1
data:
  agent.yaml: |
    logs:
        configs:
            - clients:
                - external_labels:
                    cluster: tns
                  url: http://loki.loki.svc.cluster.local:3100/loki/api/v1/push
              name: kubernetes-logs
              scrape_configs:
                - job_name: kubernetes-pods-name
                  kubernetes_sd_configs:
                    - role: pod
                  pipeline_stages:
                    - docker: {}
                  relabel_configs:
                    - source_labels:
                        - __meta_kubernetes_pod_label_name
                      target_label: __service__
                    - source_labels:
                        - __meta_kubernetes_pod_node_name
                      target_label: __host__
                    - action: drop
                      regex: ""
                      source_labels:
                        - __service__
                    - action: labelmap
                      regex: __meta_kubernetes_pod_label_(.+)
                    - action: replace
                      replacement: $1
                      separator: /
                      source_labels:
                        - __meta_kubernetes_namespace
                        - __service__
                      target_label: job
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_namespace
                      target_label: namespace
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_name
                      target_label: pod
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_container_name
                      target_label: container
                    - replacement: /var/log/pods/*$1/*.log
                      separator: /
                      source_labels:
                        - __meta_kubernetes_pod_uid
                        - __meta_kubernetes_pod_container_name
                      target_label: __path__
                - job_name: kubernetes-pods-app
                  kubernetes_sd_configs:
                    - role: pod
                  pipeline_stages:
                    - docker: {}
                  relabel_configs:
                    - action: drop
                      regex: .+
                      source_labels:
                        - __meta_kubernetes_pod_label_name
                    - source_labels:
                        - __meta_kubernetes_pod_label_app
                      target_label: __service__
                    - source_labels:
                        - __meta_kubernetes_pod_node_name
                      target_label: __host__
                    - action: drop
                      regex: ""
                      source_labels:
                        - __service__
                    - action: labelmap
                      regex: __meta_kubernetes_pod_label_(.+)
                    - action: replace
                      replacement: $1
                      separator: /
                      source_labels:
                        - __meta_kubernetes_namespace
                        - __service__
                      target_label: job
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_namespace
                      target_label: namespace
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_name
                      target_label: pod
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_container_name
                      target_label: container
                    - replacement: /var/log/pods/*$1/*.log
                      separator: /
                      source_labels:
                        - __meta_kubernetes_pod_uid
                        - __meta_kubernetes_pod_container_name
                      target_label: __path__
                - job_name: kubernetes-pods-direct-controllers
                  kubernetes_sd_configs:
                    - role: pod
                  pipeline_stages:
                    - docker: {}
                  relabel_configs:
                    - action: drop
                      regex: .+
                      separator: ""
                      source_labels:
                        - __meta_kubernetes_pod_label_name
                        - __meta_kubernetes_pod_label_app
                    - action: drop
                      regex: '[0-9a-z-.]+-[0-9a-f]{8,10}'
                      source_labels:
                        - __meta_kubernetes_pod_controller_name
                    - source_labels:
                        - __meta_kubernetes_pod_controller_name
                      target_label: __service__
                    - source_labels:
                        - __meta_kubernetes_pod_node_name
                      target_label: __host__
                    - action: drop
                      regex: ""
                      source_labels:
                        - __service__
                    - action: labelmap
                      regex: __meta_kubernetes_pod_label_(.+)
                    - action: replace
                      replacement: $1
                      separator: /
                      source_labels:
                        - __meta_kubernetes_namespace
                        - __service__
                      target_label: job
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_namespace
                      target_label: namespace
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_name
                      target_label: pod
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_container_name
                      target_label: container
                    - replacement: /var/log/pods/*$1/*.log
                      separator: /
                      source_labels:
                        - __meta_kubernetes_pod_uid
                        - __meta_kubernetes_pod_container_name
                      target_label: __path__
                - job_name: kubernetes-pods-indirect-controller
                  kubernetes_sd_configs:
                    - role: pod
                  pipeline_stages:
                    - docker: {}
                  relabel_configs:
                    - action: drop
                      regex: .+
                      separator: ""
                      source_labels:
                        - __meta_kubernetes_pod_label_name
                        - __meta_kubernetes_pod_label_app
                    - action: keep
                      regex: '[0-9a-z-.]+-[0-9a-f]{8,10}'
                      source_labels:
                        - __meta_kubernetes_pod_controller_name
                    - action: replace
                      regex: ([0-9a-z-.]+)-[0-9a-f]{8,10}
                      source_labels:
                        - __meta_kubernetes_pod_controller_name
                      target_label: __service__
                    - source_labels:
                        - __meta_kubernetes_pod_node_name
                      target_label: __host__
                    - action: drop
                      regex: ""
                      source_labels:
                        - __service__
                    - action: labelmap
                      regex: __meta_kubernetes_pod_label_(.+)
                    - action: replace
                      replacement: $1
                      separator: /
                      source_labels:
                        - __meta_kubernetes_namespace
                        - __service__
                      target_label: job
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_namespace
                      target_label: namespace
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_name
                      target_label: pod
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_container_name
                      target_label: container
                    - replacement: /var/log/pods/*$1/*.log
                      separator: /
                      source_labels:
                        - __meta_kubernetes_pod_uid
                        - __meta_kubernetes_pod_container_name
                      target_label: __path__
                - job_name: kubernetes-pods-static
                  kubernetes_sd_configs:
                    - role: pod
                  pipeline_stages:
                    - docker: {}
                  relabel_configs:
                    - action: drop
                      regex: ""
                      source_labels:
                        - __meta_kubernetes_pod_annotation_kubernetes_io_config_mirror
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_label_component
                      target_label: __service__
                    - source_labels:
                        - __meta_kubernetes_pod_node_name
                      target_label: __host__
                    - action: drop
                      regex: ""
                      source_labels:
                        - __service__
                    - action: labelmap
                      regex: __meta_kubernetes_pod_label_(.+)
                    - action: replace
                      replacement: $1
                      separator: /
                      source_labels:
                        - __meta_kubernetes_namespace
                        - __service__
                      target_label: job
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_namespace
                      target_label: namespace
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_name
                      target_label: pod
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_container_name
                      target_label: container
                    - replacement: /var/log/pods/*$1/*.log
                      separator: /
                      source_labels:
                        - __meta_kubernetes_pod_annotation_kubernetes_io_config_mirror
                        - __meta_kubernetes_pod_container_name
                      target_label: __path__
        positions_directory: /tmp/agent/loki
    metrics:
        configs:
            - name: kubernetes-metrics
              remote_write:
                - send_exemplars: true
                  url: http://mimir.mimir.svc.cluster.local/api/v1/push
              scrape_configs:
                - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
                  job_name: default/kubernetes
                  kubernetes_sd_configs:
                    - role: service
                  metric_relabel_configs:
                    - action: keep
                      regex: workqueue_queue_duration_seconds_bucket|process_cpu_seconds_total|process_resident_memory_bytes|workqueue_depth|rest_client_request_duration_seconds_bucket|workqueue_adds_total|up|rest_client_requests_total|apiserver_request_total|go_goroutines
                      source_labels:
                        - __name__
                  relabel_configs:
                    - action: keep
                      regex: apiserver
                      source_labels:
                        - __meta_kubernetes_service_label_component
                  scheme: https
                  tls_config:
                    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                    insecure_skip_verify: false
                    server_name: kubernetes
                - job_name: kubernetes-pods
                  kubernetes_sd_configs:
                    - role: pod
                  relabel_configs:
                    - action: drop
                      regex: "false"
                      source_labels:
                        - __meta_kubernetes_pod_annotation_prometheus_io_scrape
                    - action: keep
                      regex: .*-metrics
                      source_labels:
                        - __meta_kubernetes_pod_container_port_name
                    - action: replace
                      regex: (https?)
                      replacement: $1
                      source_labels:
                        - __meta_kubernetes_pod_annotation_prometheus_io_scheme
                      target_label: __scheme__
                    - action: replace
                      regex: (.+)
                      replacement: $1
                      source_labels:
                        - __meta_kubernetes_pod_annotation_prometheus_io_path
                      target_label: __metrics_path__
                    - action: replace
                      regex: (.+?)(\:\d+)?;(\d+)
                      replacement: $1:$3
                      source_labels:
                        - __address__
                        - __meta_kubernetes_pod_annotation_prometheus_io_port
                      target_label: __address__
                    - action: drop
                      regex: ""
                      source_labels:
                        - __meta_kubernetes_pod_label_name
                    - action: replace
                      replacement: $1
                      separator: /
                      source_labels:
                        - __meta_kubernetes_namespace
                        - __meta_kubernetes_pod_label_name
                      target_label: job
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_namespace
                      target_label: namespace
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_name
                      target_label: pod
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_container_name
                      target_label: container
                    - action: replace
                      separator: ':'
                      source_labels:
                        - __meta_kubernetes_pod_name
                        - __meta_kubernetes_pod_container_name
                        - __meta_kubernetes_pod_container_port_name
                      target_label: instance
                    - action: labelmap
                      regex: __meta_kubernetes_pod_annotation_prometheus_io_param_(.+)
                      replacement: __param_$1
                    - action: drop
                      regex: Succeeded|Failed
                      source_labels:
                        - __meta_kubernetes_pod_phase
                - job_name: kube-system/kube-state-metrics
                  kubernetes_sd_configs:
                    - namespaces:
                        names:
                            - kube-system
                      role: pod
                  relabel_configs:
                    - action: keep
                      regex: kube-state-metrics
                      source_labels:
                        - __meta_kubernetes_pod_label_name
                    - action: replace
                      separator: ':'
                      source_labels:
                        - __meta_kubernetes_pod_name
                        - __meta_kubernetes_pod_container_name
                        - __meta_kubernetes_pod_container_port_name
                      target_label: instance
                - job_name: kube-system/node-exporter
                  kubernetes_sd_configs:
                    - namespaces:
                        names:
                            - kube-system
                      role: pod
                  relabel_configs:
                    - action: keep
                      regex: node-exporter
                      source_labels:
                        - __meta_kubernetes_pod_label_name
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_node_name
                      target_label: instance
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_namespace
                      target_label: namespace
                - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
                  job_name: kube-system/kubelet
                  kubernetes_sd_configs:
                    - role: node
                  relabel_configs:
                    - replacement: kubernetes.default.svc.cluster.local:443
                      target_label: __address__
                    - replacement: https
                      target_label: __scheme__
                    - regex: (.+)
                      replacement: /api/v1/nodes/$1/proxy/metrics
                      source_labels:
                        - __meta_kubernetes_node_name
                      target_label: __metrics_path__
                  tls_config:
                    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                    insecure_skip_verify: false
                - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
                  job_name: kube-system/cadvisor
                  kubernetes_sd_configs:
                    - role: node
                  metric_relabel_configs:
                    - action: drop
                      regex: container_([a-z_]+);
                      source_labels:
                        - __name__
                        - image
                    - action: drop
                      regex: container_(network_tcp_usage_total|network_udp_usage_total|tasks_state|cpu_load_average_10s)
                      source_labels:
                        - __name__
                  relabel_configs:
                    - replacement: kubernetes.default.svc.cluster.local:443
                      target_label: __address__
                    - regex: (.+)
                      replacement: /api/v1/nodes/$1/proxy/metrics/cadvisor
                      source_labels:
                        - __meta_kubernetes_node_name
                      target_label: __metrics_path__
                  scheme: https
                  tls_config:
                    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                    insecure_skip_verify: false
        global:
            external_labels:
                cluster: tns
            scrape_interval: 15s
        wal_directory: /tmp/agent/prom
    server:
        log_level: debug
    traces:
        configs:
            - name: kubernetes-traces
              receivers:
                jaeger:
                    protocols:
                        grpc: null
                        thrift_binary: null
                        thrift_compact: null
                        thrift_http: null
              remote_write:
                - endpoint: tempo.tempo.svc.cluster.local:55680
                  insecure: true
                  retry_on_failure:
                    enabled: true
              scrape_configs:
                - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
                  job_name: kubernetes-pods
                  kubernetes_sd_configs:
                    - role: pod
                  relabel_configs:
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_namespace
                      target_label: namespace
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_name
                      target_label: pod
                    - action: replace
                      source_labels:
                        - __meta_kubernetes_pod_container_name
                      target_label: container
                  tls_config:
                    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                    insecure_skip_verify: false
kind: ConfigMap
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"v1","data":{"agent.yaml":"logs:\n    configs:\n        - clients:\n            - external_labels:\n                cluster: tns\n              url: http://loki.loki.svc.cluster.local:3100/loki/api/v1/push\n          name: kubernetes-logs\n          scrape_configs:\n            - job_name: kubernetes-pods-name\n              kubernetes_sd_configs:\n                - role: pod\n              pipeline_stages:\n                - docker: {}\n              relabel_configs:\n                - source_labels:\n                    - __meta_kubernetes_pod_label_name\n                  target_label: __service__\n                - source_labels:\n                    - __meta_kubernetes_pod_node_name\n                  target_label: __host__\n                - action: drop\n                  regex: \"\"\n                  source_labels:\n                    - __service__\n                - action: labelmap\n                  regex: __meta_kubernetes_pod_label_(.+)\n                - action: replace\n                  replacement: $1\n                  separator: /\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                    - __service__\n                  target_label: job\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                  target_label: namespace\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_name\n                  target_label: pod\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_container_name\n                  target_label: container\n                - replacement: /var/log/pods/*$1/*.log\n                  separator: /\n                  source_labels:\n                    - __meta_kubernetes_pod_uid\n                    - __meta_kubernetes_pod_container_name\n                  target_label: __path__\n            - job_name: kubernetes-pods-app\n              kubernetes_sd_configs:\n                - role: pod\n              pipeline_stages:\n                - docker: {}\n              relabel_configs:\n                - action: drop\n                  regex: .+\n                  source_labels:\n                    - __meta_kubernetes_pod_label_name\n                - source_labels:\n                    - __meta_kubernetes_pod_label_app\n                  target_label: __service__\n                - source_labels:\n                    - __meta_kubernetes_pod_node_name\n                  target_label: __host__\n                - action: drop\n                  regex: \"\"\n                  source_labels:\n                    - __service__\n                - action: labelmap\n                  regex: __meta_kubernetes_pod_label_(.+)\n                - action: replace\n                  replacement: $1\n                  separator: /\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                    - __service__\n                  target_label: job\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                  target_label: namespace\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_name\n                  target_label: pod\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_container_name\n                  target_label: container\n                - replacement: /var/log/pods/*$1/*.log\n                  separator: /\n                  source_labels:\n                    - __meta_kubernetes_pod_uid\n                    - __meta_kubernetes_pod_container_name\n                  target_label: __path__\n            - job_name: kubernetes-pods-direct-controllers\n              kubernetes_sd_configs:\n                - role: pod\n              pipeline_stages:\n                - docker: {}\n              relabel_configs:\n                - action: drop\n                  regex: .+\n                  separator: \"\"\n                  source_labels:\n                    - __meta_kubernetes_pod_label_name\n                    - __meta_kubernetes_pod_label_app\n                - action: drop\n                  regex: '[0-9a-z-.]+-[0-9a-f]{8,10}'\n                  source_labels:\n                    - __meta_kubernetes_pod_controller_name\n                - source_labels:\n                    - __meta_kubernetes_pod_controller_name\n                  target_label: __service__\n                - source_labels:\n                    - __meta_kubernetes_pod_node_name\n                  target_label: __host__\n                - action: drop\n                  regex: \"\"\n                  source_labels:\n                    - __service__\n                - action: labelmap\n                  regex: __meta_kubernetes_pod_label_(.+)\n                - action: replace\n                  replacement: $1\n                  separator: /\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                    - __service__\n                  target_label: job\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                  target_label: namespace\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_name\n                  target_label: pod\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_container_name\n                  target_label: container\n                - replacement: /var/log/pods/*$1/*.log\n                  separator: /\n                  source_labels:\n                    - __meta_kubernetes_pod_uid\n                    - __meta_kubernetes_pod_container_name\n                  target_label: __path__\n            - job_name: kubernetes-pods-indirect-controller\n              kubernetes_sd_configs:\n                - role: pod\n              pipeline_stages:\n                - docker: {}\n              relabel_configs:\n                - action: drop\n                  regex: .+\n                  separator: \"\"\n                  source_labels:\n                    - __meta_kubernetes_pod_label_name\n                    - __meta_kubernetes_pod_label_app\n                - action: keep\n                  regex: '[0-9a-z-.]+-[0-9a-f]{8,10}'\n                  source_labels:\n                    - __meta_kubernetes_pod_controller_name\n                - action: replace\n                  regex: ([0-9a-z-.]+)-[0-9a-f]{8,10}\n                  source_labels:\n                    - __meta_kubernetes_pod_controller_name\n                  target_label: __service__\n                - source_labels:\n                    - __meta_kubernetes_pod_node_name\n                  target_label: __host__\n                - action: drop\n                  regex: \"\"\n                  source_labels:\n                    - __service__\n                - action: labelmap\n                  regex: __meta_kubernetes_pod_label_(.+)\n                - action: replace\n                  replacement: $1\n                  separator: /\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                    - __service__\n                  target_label: job\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                  target_label: namespace\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_name\n                  target_label: pod\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_container_name\n                  target_label: container\n                - replacement: /var/log/pods/*$1/*.log\n                  separator: /\n                  source_labels:\n                    - __meta_kubernetes_pod_uid\n                    - __meta_kubernetes_pod_container_name\n                  target_label: __path__\n            - job_name: kubernetes-pods-static\n              kubernetes_sd_configs:\n                - role: pod\n              pipeline_stages:\n                - docker: {}\n              relabel_configs:\n                - action: drop\n                  regex: \"\"\n                  source_labels:\n                    - __meta_kubernetes_pod_annotation_kubernetes_io_config_mirror\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_label_component\n                  target_label: __service__\n                - source_labels:\n                    - __meta_kubernetes_pod_node_name\n                  target_label: __host__\n                - action: drop\n                  regex: \"\"\n                  source_labels:\n                    - __service__\n                - action: labelmap\n                  regex: __meta_kubernetes_pod_label_(.+)\n                - action: replace\n                  replacement: $1\n                  separator: /\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                    - __service__\n                  target_label: job\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                  target_label: namespace\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_name\n                  target_label: pod\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_container_name\n                  target_label: container\n                - replacement: /var/log/pods/*$1/*.log\n                  separator: /\n                  source_labels:\n                    - __meta_kubernetes_pod_annotation_kubernetes_io_config_mirror\n                    - __meta_kubernetes_pod_container_name\n                  target_label: __path__\n    positions_directory: /tmp/agent/loki\nmetrics:\n    configs:\n        - name: kubernetes-metrics\n          remote_write:\n            - send_exemplars: true\n              url: http://mimir.mimir.svc.cluster.local/api/v1/push\n          scrape_configs:\n            - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n              job_name: default/kubernetes\n              kubernetes_sd_configs:\n                - role: service\n              metric_relabel_configs:\n                - action: keep\n                  regex: workqueue_queue_duration_seconds_bucket|process_cpu_seconds_total|process_resident_memory_bytes|workqueue_depth|rest_client_request_duration_seconds_bucket|workqueue_adds_total|up|rest_client_requests_total|apiserver_request_total|go_goroutines\n                  source_labels:\n                    - __name__\n              relabel_configs:\n                - action: keep\n                  regex: apiserver\n                  source_labels:\n                    - __meta_kubernetes_service_label_component\n              scheme: https\n              tls_config:\n                ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n                insecure_skip_verify: false\n                server_name: kubernetes\n            - job_name: kubernetes-pods\n              kubernetes_sd_configs:\n                - role: pod\n              relabel_configs:\n                - action: drop\n                  regex: \"false\"\n                  source_labels:\n                    - __meta_kubernetes_pod_annotation_prometheus_io_scrape\n                - action: keep\n                  regex: .*-metrics\n                  source_labels:\n                    - __meta_kubernetes_pod_container_port_name\n                - action: replace\n                  regex: (https?)\n                  replacement: $1\n                  source_labels:\n                    - __meta_kubernetes_pod_annotation_prometheus_io_scheme\n                  target_label: __scheme__\n                - action: replace\n                  regex: (.+)\n                  replacement: $1\n                  source_labels:\n                    - __meta_kubernetes_pod_annotation_prometheus_io_path\n                  target_label: __metrics_path__\n                - action: replace\n                  regex: (.+?)(\\:\\d+)?;(\\d+)\n                  replacement: $1:$3\n                  source_labels:\n                    - __address__\n                    - __meta_kubernetes_pod_annotation_prometheus_io_port\n                  target_label: __address__\n                - action: drop\n                  regex: \"\"\n                  source_labels:\n                    - __meta_kubernetes_pod_label_name\n                - action: replace\n                  replacement: $1\n                  separator: /\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                    - __meta_kubernetes_pod_label_name\n                  target_label: job\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                  target_label: namespace\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_name\n                  target_label: pod\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_container_name\n                  target_label: container\n                - action: replace\n                  separator: ':'\n                  source_labels:\n                    - __meta_kubernetes_pod_name\n                    - __meta_kubernetes_pod_container_name\n                    - __meta_kubernetes_pod_container_port_name\n                  target_label: instance\n                - action: labelmap\n                  regex: __meta_kubernetes_pod_annotation_prometheus_io_param_(.+)\n                  replacement: __param_$1\n                - action: drop\n                  regex: Succeeded|Failed\n                  source_labels:\n                    - __meta_kubernetes_pod_phase\n            - job_name: kube-system/kube-state-metrics\n              kubernetes_sd_configs:\n                - namespaces:\n                    names:\n                        - kube-system\n                  role: pod\n              relabel_configs:\n                - action: keep\n                  regex: kube-state-metrics\n                  source_labels:\n                    - __meta_kubernetes_pod_label_name\n                - action: replace\n                  separator: ':'\n                  source_labels:\n                    - __meta_kubernetes_pod_name\n                    - __meta_kubernetes_pod_container_name\n                    - __meta_kubernetes_pod_container_port_name\n                  target_label: instance\n            - job_name: kube-system/node-exporter\n              kubernetes_sd_configs:\n                - namespaces:\n                    names:\n                        - kube-system\n                  role: pod\n              relabel_configs:\n                - action: keep\n                  regex: node-exporter\n                  source_labels:\n                    - __meta_kubernetes_pod_label_name\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_node_name\n                  target_label: instance\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                  target_label: namespace\n            - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n              job_name: kube-system/kubelet\n              kubernetes_sd_configs:\n                - role: node\n              relabel_configs:\n                - replacement: kubernetes.default.svc.cluster.local:443\n                  target_label: __address__\n                - replacement: https\n                  target_label: __scheme__\n                - regex: (.+)\n                  replacement: /api/v1/nodes/$1/proxy/metrics\n                  source_labels:\n                    - __meta_kubernetes_node_name\n                  target_label: __metrics_path__\n              tls_config:\n                ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n                insecure_skip_verify: false\n            - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n              job_name: kube-system/cadvisor\n              kubernetes_sd_configs:\n                - role: node\n              metric_relabel_configs:\n                - action: drop\n                  regex: container_([a-z_]+);\n                  source_labels:\n                    - __name__\n                    - image\n                - action: drop\n                  regex: container_(network_tcp_usage_total|network_udp_usage_total|tasks_state|cpu_load_average_10s)\n                  source_labels:\n                    - __name__\n              relabel_configs:\n                - replacement: kubernetes.default.svc.cluster.local:443\n                  target_label: __address__\n                - regex: (.+)\n                  replacement: /api/v1/nodes/$1/proxy/metrics/cadvisor\n                  source_labels:\n                    - __meta_kubernetes_node_name\n                  target_label: __metrics_path__\n              scheme: https\n              tls_config:\n                ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n                insecure_skip_verify: false\n    global:\n        external_labels:\n            cluster: tns\n        scrape_interval: 15s\n    wal_directory: /tmp/agent/prom\nserver:\n    log_level: debug\ntraces:\n    configs:\n        - name: kubernetes-traces\n          receivers:\n            jaeger:\n                protocols:\n                    grpc: null\n                    thrift_binary: null\n                    thrift_compact: null\n                    thrift_http: null\n          remote_write:\n            - endpoint: tempo.tempo.svc.cluster.local:55680\n              insecure: true\n              retry_on_failure:\n                enabled: true\n          scrape_configs:\n            - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n              job_name: kubernetes-pods\n              kubernetes_sd_configs:\n                - role: pod\n              relabel_configs:\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_namespace\n                  target_label: namespace\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_name\n                  target_label: pod\n                - action: replace\n                  source_labels:\n                    - __meta_kubernetes_pod_container_name\n                  target_label: container\n              tls_config:\n                ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n                insecure_skip_verify: false\n"},"kind":"ConfigMap","metadata":{"annotations":{},"name":"grafana-agent","namespace":"default"}}
  name: grafana-agent
  namespace: default
